@{
    ViewData["Title"] = "Ödeme Yönetimi";
}

<!-- Bootstrap & DataTables stilleri -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css" />

<div class="container mt-4">
    <h2>@ViewData["Title"]</h2>

    <!-- Sekmeler -->
    <ul class="nav nav-pills mb-3" id="tabMenu" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="ekle-tab" data-bs-toggle="pill" data-bs-target="#ekle" type="button" role="tab">Ödeme Yükle</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="liste-tab" data-bs-toggle="pill" data-bs-target="#liste" type="button" role="tab">Tüm Ödemeler</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="microsoft-tab" data-bs-toggle="pill" data-bs-target="#microsoft" type="button" role="tab">Microsoft</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="oracle-tab" data-bs-toggle="pill" data-bs-target="#oracle" type="button" role="tab">Oracle</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="nvidia-tab" data-bs-toggle="pill" data-bs-target="#nvidia" type="button" role="tab">Nvidia</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="ford-tab" data-bs-toggle="pill" data-bs-target="#ford" type="button" role="tab">Ford</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="pegasus-tab" data-bs-toggle="pill" data-bs-target="#pegasus" type="button" role="tab">Pegasus</button>
        </li>
    </ul>

    <div class="tab-content" id="tabContent">
        <!-- Ödeme Yükle -->
        <div class="tab-pane fade show active" id="ekle" role="tabpanel">
            <form id="uploadForm" enctype="multipart/form-data" class="p-3 border rounded">
                <div class="mb-3">
                    <label class="form-label">Şirket Kodu (SKod) :</label>
                    <input type="number" name="SKod" class="form-control" required />
                </div>
                <div class="mb-3">
                    <label class="form-label">Ödeme Dosyası (.txt):</label>
                    <input type="file" name="Dosya" accept=".txt" class="form-control" required />
                </div>
                <button type="submit" class="btn btn-primary w-100">Yükle</button>
            </form>
            <div id="mesaj" class="p-3"></div>
        </div>

        <!-- Tüm Ödemeler -->
        <div class="tab-pane fade" id="liste" role="tabpanel">
            <table id="sonuclar" class="display table table-striped mt-3" style="width:100%;">
                <thead>
                    <tr>
                        <th>Şirket Adı</th>
                        <th>Ödenen Tutar</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <!-- Şirket Sekmeleri -->
        <div class="tab-pane fade" id="microsoft" role="tabpanel">
            <table id="microsoftOdemeleri" class="display table table-striped mt-3" style="width:100%;">
                <thead><tr><th>Şirket Adı</th><th>Ödenen Tutar</th></tr></thead>
                <tbody></tbody>
            </table>
        </div>

        <div class="tab-pane fade" id="oracle" role="tabpanel">
            <table id="oracleOdemeleri" class="display table table-striped mt-3" style="width:100%;">
                <thead><tr><th>Şirket Adı</th><th>Ödenen Tutar</th></tr></thead>
                <tbody></tbody>
            </table>
        </div>

        <div class="tab-pane fade" id="nvidia" role="tabpanel">
            <table id="nvidiaOdemeleri" class="display table table-striped mt-3" style="width:100%;">
                <thead><tr><th>Şirket Adı</th><th>Ödenen Tutar</th></tr></thead>
                <tbody></tbody>
            </table>
        </div>

        <div class="tab-pane fade" id="ford" role="tabpanel">
            <table id="fordOdemeleri" class="display table table-striped mt-3" style="width:100%;">
                <thead><tr><th>Şirket Adı</th><th>Ödenen Tutar</th></tr></thead>
                <tbody></tbody>
            </table>
        </div>

        <div class="tab-pane fade" id="pegasus" role="tabpanel">
            <table id="pegasusOdemeleri" class="display table table-striped mt-3" style="width:100%;">
                <thead><tr><th>Şirket Adı</th><th>Ödenen Tutar</th></tr></thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
</div>

<!-- JS Kütüphaneleri -->
<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
    let table, tableMicrosoft, tableOracle, tableNvidia, tableFord, tablePegasus;

    $(document).ready(function () {
        // DataTables init
        table = $('#sonuclar').DataTable({ columns: [{ data: 'sirketAd' }, { data: 'odenenTutar' }] });
        tableMicrosoft = $('#microsoftOdemeleri').DataTable({ columns: [{ data: 'sirketAd' }, { data: 'odenenTutar' }] });
        tableOracle = $('#oracleOdemeleri').DataTable({ columns: [{ data: 'sirketAd' }, { data: 'odenenTutar' }] });
        tableNvidia = $('#nvidiaOdemeleri').DataTable({ columns: [{ data: 'sirketAd' }, { data: 'odenenTutar' }] });
        tableFord = $('#fordOdemeleri').DataTable({ columns: [{ data: 'sirketAd' }, { data: 'odenenTutar' }] });
        tablePegasus = $('#pegasusOdemeleri').DataTable({ columns: [{ data: 'sirketAd' }, { data: 'odenenTutar' }] });

        // Sekmelere veri çekme
        $('button[data-bs-target="#liste"]').on('shown.bs.tab', () => {
            fetch("/Home/TumOdemeleriGetir").then(res => res.json()).then(data => {
                table.clear().rows.add(data).draw();
            });
        });

        $('button[data-bs-target="#microsoft"]').on('shown.bs.tab', () => {
            fetch("/Home/MicrosoftSirketiOdemeleri").then(res => res.json()).then(data => {
                tableMicrosoft.clear().rows.add(data).draw();
            });
        });

        $('button[data-bs-target="#oracle"]').on('shown.bs.tab', () => {
            fetch("/Home/OracleSirketiOdemeleri").then(res => res.json()).then(data => {
                tableOracle.clear().rows.add(data).draw();
            });
        });

        $('button[data-bs-target="#nvidia"]').on('shown.bs.tab', () => {
            fetch("/Home/NvidiaSirketiOdemeleri").then(res => res.json()).then(data => {
                tableNvidia.clear().rows.add(data).draw();
            });
        });

        $('button[data-bs-target="#ford"]').on('shown.bs.tab', () => {
            fetch("/Home/FordSirketiOdemeleri").then(res => res.json()).then(data => {
                tableFord.clear().rows.add(data).draw();
            });
        });

        $('button[data-bs-target="#pegasus"]').on('shown.bs.tab', () => {
            fetch("/Home/PegasusSirketiOdemeleri").then(res => res.json()).then(data => {
                tablePegasus.clear().rows.add(data).draw();
            });
        });

        // Form Yükleme
        $('#uploadForm').on('submit', function (e) {
            e.preventDefault();
            const formData = new FormData(this);

            fetch("/Home/OdemeYukleAjax", {
                method: "POST",
                body: formData
            })
            .then(res => res.json())
            .then(data => {
                const mesajDiv = document.getElementById("mesaj");
                mesajDiv.style.color = data.success ? "green" : "red";
                mesajDiv.innerText = data.message;
                if (data.success) setTimeout(() => mesajDiv.innerText = "", 3000);
            })
            .catch(() => {
                document.getElementById("mesaj").style.color = "red";
                document.getElementById("mesaj").innerText = "Bir hata oluştu.";
            });
        });
    });
</script>
